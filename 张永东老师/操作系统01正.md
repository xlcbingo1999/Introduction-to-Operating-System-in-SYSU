# 操作系统01 笔记

> 张永东老师
> 学习方法：听正式网课

## 0. 课程安排

### 0.1 上课次序调整

1. introduction
2. os structurs
3. processes 部分
4. memory management 内存管理
5. virtual memory 虚存
6. processes 进程
7. threads 线程
8. CPU scheduling 调度
9. process synchronization 同步
10. deadlocks 死锁
11. file system interface 接口
12. file system implementation 实现
13. mass-storage structure 大容量存储器结构
14. I/O systems 系统
15. protection 保护(选讲)
16. security 安全(选讲)

## 1. 操作系统介绍

### 1.1 计算机系统结构

分为四个部分

* 硬件——提供基本的计算单元
  * CPU, memory, I/O devices
* 操作系统
  * 控制和协调可用户的应用程序对硬件的使用
* 应用程序：规定了用户按何种方式使用这些资源
  * word processors, compilers, web browsers, database
* 用户

![J32bzn.png](https://s1.ax1x.com/2020/04/21/J32bzn.png)

### 1.2 操作系统是什么

操作系统是在电脑用户和计算机硬件之间充当中介的一个程序。

目标：

* 执行程序并使得更容易解决用户问题
* 使计算机系统能方便地使用
* 以高效的方式使用计算机硬件

旧版的操作系统：使用卡片机。昂贵且效率低下，需要人工装入卡片。

操作系统的原形；监督程序。用于程序的执行。

多道程序执行：程序扩展，外设管理。由此操作系统变成用于管理的程序。

### 1.3 操作系统的定义

1. 操作系统是资源的分配者
   * 管理所有资源
   * 决定如何为各个程序和用户分配资源，以便有效且公平地使用资源
2. 操作系统是控制程序
   * 管理程序的执行以防止对计算机（资源）的错误的或者不当的使用。

目前没有公认的定义，而且变化很大。

### 1.4 操作系统启动

* 自举程序(bootstrap program)在power-up或者reboot时使用
  * 存在ROM或者EEPROM中，这些设备通常被认为是固件。
  * 初始化系统
  * 加载操作系统内核，开始运行

所有的外设都是通过控制器和总线连接在一起的。CPU不能直接访问到外设，必须使用控制器。

![J3h77V.png](https://s1.ax1x.com/2020/04/21/J3h77V.png)

### 1.5 计算机系统操作

* I/O设备和CPU可以并发执行
* 每一个控制器负责某一特定类型的设备
* 每一个设备控制器都有局部缓存(local buffer)
* CPU通过局部缓存和主存交换数据(端口号)
* I/O从设备到控制器的局部缓存
* 设备控制器会通知CPU外设的操作已经完成，通过引起中断的方式进行。

控制器卡上通常有一个插座，通过电缆与设备相连。

控制器和设备之间的接口是一个标准接口，符合ANSI、IEEE、ISO这样的国际标准。

设备控制器一般拥有的局部缓存：

![J3oo2F.png](https://s1.ax1x.com/2020/04/21/J3oo2F.png)

### 1.6 计算机的基本工作原理

#### 1.6.1 存储程序控制原理

程序存储，将程序和要处理的数据以二进制形式表示，并预存到

#### 1.6.2 CPU结构和任务

* CPU主要由运算器、控制器和寄存器组3个部分组成。
* CPU的任务：取指令并完成指令所规定的操作。

#### 1.6.3 系统启动过程

* 加电
* 运行初始化程序（或自举程序，在ROM中）
* 装入引导程序并执行
* 引导程序装入操作系统内核到内存
* 操作系统执行第一个进程init，并等待某些事件发生
  * 系统

#### 1.6.4 具有中断处理时的指令执行周期

#### 1.6.5 中断的常见功能

* 中断：系统发生某个异步/同步事件后，处理机暂停正在执行的程序，转去执行处理该事件程序的过程。
* 通常中断通过中断向量把控制传送给中断服务程序，该中断向量包含了所有服务程序的地址。【中断向量存着地址、中断号等】
* 中断体系结构必须保护被中断指令的地址
* 当一个中断正在处理时，另一个刚进入的中断是不能响应的，以免丢失中断
* 陷阱（trap）是由于出错或用户请求引起的软件
* 操作系统是中断驱动的。【中断处理程序是操作系统的内核程序，进入中断处理程序就是进入系统内部了，除了中断之外还可以进行其他很多其他事情，CPU一直执行的是while(true)，必须由中断才可以出来，计算机会固定在特定的时间执行中断(比如1ms)】
* 多个程序一起运行->使用中断判断开始和结束？【比如请求打印：进入了操作系统中，使得要打印的这个程序睡眠队列中，让出CPU，操作系统分配一个写磁盘，写完之后程序进入睡眠队列中，设备控制器跟CPU发出一个中断信号，CPU给打印器发出一个中断信号】

#### 1.6.6 没有中断如何判断事件发生

使用轮询(polling,投票)：对局部缓存中的状态寄存器进行查询。CPU一直处于忙碌状态，因为CPU一直需要查询状态。

CPU位于上面为忙碌于其他地方，下面为忙碌于本程序。

I/O设备位于上面为空闲，下面为忙碌于本程序。

![J3Xnkd.png](https://s1.ax1x.com/2020/04/21/J3Xnkd.png)